# HG changeset patch
# Parent 329c0ab7824b1e0e5a850f2175dbf6b4986487ef

diff --git a/target/linux/generic/patches-3.12/060-hso_devices.patch b/target/linux/generic/patches-3.12/060-hso_devices.patch
--- a/target/linux/generic/patches-3.12/060-hso_devices.patch
+++ b/target/linux/generic/patches-3.12/060-hso_devices.patch
@@ -15,7 +15,7 @@
  	{USB_DEVICE(0x0af0, 0xd155)},
 --- a/drivers/usb/storage/unusual_devs.h
 +++ b/drivers/usb/storage/unusual_devs.h
-@@ -1266,6 +1266,18 @@ UNUSUAL_DEV( 0x0af0, 0x8304, 0x0000, 0x0
+@@ -1324,6 +1324,18 @@ UNUSUAL_DEV( 0x0af0, 0x8304, 0x0000, 0x0
  		USB_SC_DEVICE, USB_PR_DEVICE, NULL,
  		0 ),
  
diff --git a/target/linux/generic/patches-3.12/062-mips_decompressor_build_fix.patch b/target/linux/generic/patches-3.12/062-mips_decompressor_build_fix.patch
--- a/target/linux/generic/patches-3.12/062-mips_decompressor_build_fix.patch
+++ b/target/linux/generic/patches-3.12/062-mips_decompressor_build_fix.patch
@@ -61,6 +61,6 @@ Signed-off-by: Florian Fainelli <florian
 -
  #include <linux/types.h>
 -#include <linux/kernel.h>
+ #include <linux/string.h>
  
  #include <asm/addrspace.h>
- 
diff --git a/target/linux/generic/patches-3.12/081-pppoe-Use-workqueue-to-die-properly-when-a-PADT-is-r.patch b/target/linux/generic/patches-3.12/081-pppoe-Use-workqueue-to-die-properly-when-a-PADT-is-r.patch
--- a/target/linux/generic/patches-3.12/081-pppoe-Use-workqueue-to-die-properly-when-a-PADT-is-r.patch
+++ b/target/linux/generic/patches-3.12/081-pppoe-Use-workqueue-to-die-properly-when-a-PADT-is-r.patch
@@ -31,7 +31,7 @@ Signed-off-by: David S. Miller <davem@da
 
 --- a/drivers/net/ppp/pppoe.c
 +++ b/drivers/net/ppp/pppoe.c
-@@ -455,6 +455,18 @@ out:
+@@ -456,6 +456,18 @@ out:
  	return NET_RX_DROP;
  }
  
@@ -50,7 +50,7 @@ Signed-off-by: David S. Miller <davem@da
  /************************************************************************
   *
   * Receive a PPPoE Discovery frame.
-@@ -500,7 +512,8 @@ static int pppoe_disc_rcv(struct sk_buff
+@@ -501,7 +513,8 @@ static int pppoe_disc_rcv(struct sk_buff
  		}
  
  		bh_unlock_sock(sk);
@@ -60,7 +60,7 @@ Signed-off-by: David S. Miller <davem@da
  	}
  
  abort:
-@@ -613,6 +626,8 @@ static int pppoe_connect(struct socket *
+@@ -614,6 +627,8 @@ static int pppoe_connect(struct socket *
  
  	lock_sock(sk);
  
diff --git a/target/linux/generic/patches-3.12/100-overlayfs.patch b/target/linux/generic/patches-3.12/100-overlayfs.patch
--- a/target/linux/generic/patches-3.12/100-overlayfs.patch
+++ b/target/linux/generic/patches-3.12/100-overlayfs.patch
@@ -279,7 +279,7 @@
  obj-$(CONFIG_OMFS_FS)		+= omfs/
 --- a/fs/ecryptfs/main.c
 +++ b/fs/ecryptfs/main.c
-@@ -566,6 +566,13 @@ static struct dentry *ecryptfs_mount(str
+@@ -576,6 +576,13 @@ static struct dentry *ecryptfs_mount(str
  	s->s_maxbytes = path.dentry->d_sb->s_maxbytes;
  	s->s_blocksize = path.dentry->d_sb->s_blocksize;
  	s->s_magic = ECRYPTFS_SUPER_MAGIC;
@@ -303,7 +303,7 @@
  extern int user_path_mountpoint_at(int, const char __user *, unsigned int, struct path *);
  extern int vfs_path_lookup(struct dentry *, struct vfsmount *,
  			   const char *, unsigned int, struct path *);
-@@ -142,12 +141,6 @@ extern ssize_t __kernel_write(struct fil
+@@ -139,12 +138,6 @@ extern ssize_t __kernel_write(struct fil
  extern int rw_verify_area(int, struct file *, const loff_t *, size_t);
  
  /*
@@ -318,7 +318,7 @@
  extern const struct file_operations pipefifo_fops;
 --- a/fs/namei.c
 +++ b/fs/namei.c
-@@ -402,6 +402,7 @@ int __inode_permission(struct inode *ino
+@@ -404,6 +404,7 @@ int __inode_permission(struct inode *ino
  
  	return security_inode_permission(inode, mask);
  }
@@ -326,7 +326,7 @@
  
  /**
   * sb_permission - Check superblock-level permissions
-@@ -3065,9 +3066,12 @@ finish_open_created:
+@@ -3095,9 +3096,12 @@ finish_open_created:
  	error = may_open(&nd->path, acc_mode, open_flag);
  	if (error)
  		goto out;
@@ -344,7 +344,7 @@
  		goto out;
 --- a/fs/namespace.c
 +++ b/fs/namespace.c
-@@ -1466,6 +1466,33 @@ void drop_collected_mounts(struct vfsmou
+@@ -1486,6 +1486,33 @@ void drop_collected_mounts(struct vfsmou
  	namespace_unlock();
  }
  
@@ -380,7 +380,7 @@
  {
 --- a/fs/open.c
 +++ b/fs/open.c
-@@ -814,8 +814,7 @@ struct file *dentry_open(const struct pa
+@@ -800,8 +800,7 @@ struct file *dentry_open(const struct pa
  	f = get_empty_filp();
  	if (!IS_ERR(f)) {
  		f->f_flags = flags;
@@ -390,7 +390,7 @@
  		if (!error) {
  			/* from now on we need fput() to dispose of f */
  			error = open_check_o_direct(f);
-@@ -832,6 +831,26 @@ struct file *dentry_open(const struct pa
+@@ -818,6 +817,26 @@ struct file *dentry_open(const struct pa
  }
  EXPORT_SYMBOL(dentry_open);
  
@@ -3147,7 +3147,7 @@
 +module_exit(ovl_exit);
 --- a/fs/splice.c
 +++ b/fs/splice.c
-@@ -1327,6 +1327,7 @@ long do_splice_direct(struct file *in, l
+@@ -1345,6 +1345,7 @@ long do_splice_direct(struct file *in, l
  
  	return ret;
  }
@@ -3170,7 +3170,7 @@
  /** 
   * enum positive_aop_returns - aop return codes with specific semantics
   *
-@@ -1330,6 +1336,11 @@ struct super_block {
+@@ -1317,6 +1323,11 @@ struct super_block {
  	 */
  	struct list_lru		s_dentry_lru ____cacheline_aligned_in_smp;
  	struct list_lru		s_inode_lru ____cacheline_aligned_in_smp;
@@ -3182,7 +3182,7 @@
  };
  
  extern struct timespec current_fs_time(struct super_block *sb);
-@@ -1585,6 +1596,7 @@ struct inode_operations {
+@@ -1572,6 +1583,7 @@ struct inode_operations {
  			   struct file *, unsigned open_flag,
  			   umode_t create_mode, int *opened);
  	int (*tmpfile) (struct inode *, struct dentry *, umode_t);
@@ -3190,15 +3190,15 @@
  } ____cacheline_aligned;
  
  ssize_t rw_copy_check_uvector(int type, const struct iovec __user * uvector,
-@@ -2019,6 +2031,7 @@ extern struct file *file_open_name(struc
+@@ -2006,6 +2018,7 @@ extern struct file *file_open_name(struc
  extern struct file *filp_open(const char *, int, umode_t);
  extern struct file *file_open_root(struct dentry *, struct vfsmount *,
- 				   const char *, int);
+ 				   const char *, int, umode_t);
 +extern int vfs_open(const struct path *, struct file *, const struct cred *);
  extern struct file * dentry_open(const struct path *, int, const struct cred *);
  extern int filp_close(struct file *, fl_owner_t id);
  
-@@ -2225,6 +2238,7 @@ extern sector_t bmap(struct inode *, sec
+@@ -2218,6 +2231,7 @@ extern sector_t bmap(struct inode *, sec
  #endif
  extern int notify_change(struct dentry *, struct iattr *);
  extern int inode_permission(struct inode *, int);
@@ -3206,7 +3206,7 @@
  extern int generic_permission(struct inode *, int);
  
  static inline bool execute_ok(struct inode *inode)
-@@ -2430,6 +2444,9 @@ extern ssize_t generic_file_splice_write
+@@ -2423,6 +2437,9 @@ extern ssize_t generic_file_splice_write
  		struct file *, loff_t *, size_t, unsigned int);
  extern ssize_t generic_splice_sendpage(struct pipe_inode_info *pipe,
  		struct file *out, loff_t *, size_t len, unsigned int flags);
@@ -3218,7 +3218,7 @@
  file_ra_state_init(struct file_ra_state *ra, struct address_space *mapping);
 --- a/include/linux/mount.h
 +++ b/include/linux/mount.h
-@@ -69,6 +69,9 @@ extern void mnt_pin(struct vfsmount *mnt
+@@ -76,6 +76,9 @@ extern void mnt_pin(struct vfsmount *mnt
  extern void mnt_unpin(struct vfsmount *mnt);
  extern int __mnt_is_readonly(struct vfsmount *mnt);
  
diff --git a/target/linux/generic/patches-3.12/100-pppoe-drop-pppoe-device-in-pppoe_unbind_sock_work.patch b/target/linux/generic/patches-3.12/100-pppoe-drop-pppoe-device-in-pppoe_unbind_sock_work.patch
--- a/target/linux/generic/patches-3.12/100-pppoe-drop-pppoe-device-in-pppoe_unbind_sock_work.patch
+++ b/target/linux/generic/patches-3.12/100-pppoe-drop-pppoe-device-in-pppoe_unbind_sock_work.patch
@@ -14,7 +14,7 @@ Signed-off-by: Felix Fietkau <nbd@openwr
 
 --- a/drivers/net/ppp/pppoe.c
 +++ b/drivers/net/ppp/pppoe.c
-@@ -462,6 +462,10 @@ static void pppoe_unbind_sock_work(struc
+@@ -463,6 +463,10 @@ static void pppoe_unbind_sock_work(struc
  	struct sock *sk = sk_pppox(po);
  
  	lock_sock(sk);
diff --git a/target/linux/generic/patches-3.12/101-pppoe-fix-disconnect-crash.patch b/target/linux/generic/patches-3.12/101-pppoe-fix-disconnect-crash.patch
deleted file mode 100755
--- a/target/linux/generic/patches-3.12/101-pppoe-fix-disconnect-crash.patch
+++ /dev/null
@@ -1,16 +0,0 @@
-Fix crash with actions performed on the underlying interface (MAC address,
-MTU or link state update). This triggers pppoe_flush_dev(), which cleans up
-the device without announcing it in sk->sk_state.
-
-Patch by Guillaume Nault (pulled from netdev@vger)
-
---- a/drivers/net/ppp/pppoe.c
-+++ b/drivers/net/ppp/pppoe.c
-@@ -313,7 +313,6 @@ static void pppoe_flush_dev(struct net_d
- 			if (po->pppoe_dev == dev &&
- 			    sk->sk_state & (PPPOX_CONNECTED | PPPOX_BOUND | PPPOX_ZOMBIE)) {
- 				pppox_unbind_sock(sk);
--				sk->sk_state = PPPOX_ZOMBIE;
- 				sk->sk_state_change(sk);
- 				po->pppoe_dev = NULL;
- 				dev_put(dev);
diff --git a/target/linux/generic/patches-3.12/102-ehci_hcd_ignore_oc.patch b/target/linux/generic/patches-3.12/102-ehci_hcd_ignore_oc.patch
--- a/target/linux/generic/patches-3.12/102-ehci_hcd_ignore_oc.patch
+++ b/target/linux/generic/patches-3.12/102-ehci_hcd_ignore_oc.patch
@@ -31,7 +31,7 @@ Signed-off-by: Florian Fainelli <florian
  		    &ehci->regs->intr_enable); /* Turn On Interrupts */
 --- a/drivers/usb/host/ehci-hub.c
 +++ b/drivers/usb/host/ehci-hub.c
-@@ -641,7 +641,7 @@ ehci_hub_status_data (struct usb_hcd *hc
+@@ -644,7 +644,7 @@ ehci_hub_status_data (struct usb_hcd *hc
  	 * always set, seem to clear PORT_OCC and PORT_CSC when writing to
  	 * PORT_POWER; that's surprising, but maybe within-spec.
  	 */
@@ -40,7 +40,7 @@ Signed-off-by: Florian Fainelli <florian
  		mask = PORT_CSC | PORT_PEC | PORT_OCC;
  	else
  		mask = PORT_CSC | PORT_PEC;
-@@ -1001,7 +1001,7 @@ static int ehci_hub_control (
+@@ -1004,7 +1004,7 @@ static int ehci_hub_control (
  		if (temp & PORT_PEC)
  			status |= USB_PORT_STAT_C_ENABLE << 16;
  
diff --git a/target/linux/generic/patches-3.12/120-bridge_allow_receiption_on_disabled_port.patch b/target/linux/generic/patches-3.12/120-bridge_allow_receiption_on_disabled_port.patch
--- a/target/linux/generic/patches-3.12/120-bridge_allow_receiption_on_disabled_port.patch
+++ b/target/linux/generic/patches-3.12/120-bridge_allow_receiption_on_disabled_port.patch
@@ -23,12 +23,9 @@ Signed-off-by: Felix Fietkau <nbd@openwr
 +	if (p->state != BR_STATE_DISABLED) {
 +		u16 vid = 0;
  
--	br_vlan_get_tag(skb, &vid);
--	if (p->flags & BR_LEARNING)
--		br_fdb_update(p->br, p, eth_hdr(skb)->h_source, vid);
-+		br_vlan_get_tag(skb, &vid);
-+		if (p->flags & BR_LEARNING)
-+			br_fdb_update(p->br, p, eth_hdr(skb)->h_source, vid);
+ 	/* check if vlan is allowed, to avoid spoofing */
+ 	if (p->flags & BR_LEARNING && br_should_learn(p, skb, &vid))
+ 		br_fdb_update(p->br, p, eth_hdr(skb)->h_source, vid);
 +	}
  	return 0;	 /* process further */
  }
diff --git a/target/linux/generic/patches-3.12/201-extra_optimization.patch b/target/linux/generic/patches-3.12/201-extra_optimization.patch
--- a/target/linux/generic/patches-3.12/201-extra_optimization.patch
+++ b/target/linux/generic/patches-3.12/201-extra_optimization.patch
@@ -1,6 +1,6 @@
 --- a/Makefile
 +++ b/Makefile
-@@ -571,9 +571,9 @@ endif # $(dot-config)
+@@ -573,9 +573,9 @@ endif # $(dot-config)
  all: vmlinux
  
  ifdef CONFIG_CC_OPTIMIZE_FOR_SIZE
diff --git a/target/linux/generic/patches-3.12/202-reduce_module_size.patch b/target/linux/generic/patches-3.12/202-reduce_module_size.patch
--- a/target/linux/generic/patches-3.12/202-reduce_module_size.patch
+++ b/target/linux/generic/patches-3.12/202-reduce_module_size.patch
@@ -1,6 +1,6 @@
 --- a/Makefile
 +++ b/Makefile
-@@ -379,7 +379,7 @@ KBUILD_CFLAGS_KERNEL :=
+@@ -381,7 +381,7 @@ KBUILD_CFLAGS_KERNEL :=
  KBUILD_AFLAGS   := -D__ASSEMBLY__
  KBUILD_AFLAGS_MODULE  := -DMODULE
  KBUILD_CFLAGS_MODULE  := -DMODULE
diff --git a/target/linux/generic/patches-3.12/204-module_strip.patch b/target/linux/generic/patches-3.12/204-module_strip.patch
--- a/target/linux/generic/patches-3.12/204-module_strip.patch
+++ b/target/linux/generic/patches-3.12/204-module_strip.patch
@@ -5,16 +5,7 @@ Signed-off-by: Felix Fietkau <nbd@openwr
 ---
 --- a/include/linux/module.h
 +++ b/include/linux/module.h
-@@ -83,7 +83,7 @@ void sort_extable(struct exception_table
- void sort_main_extable(void);
- void trim_init_extable(struct module *m);
- 
--#ifdef MODULE
-+#if defined(MODULE) && !defined(CONFIG_MODULE_STRIPPED)
- #define MODULE_GENERIC_TABLE(gtype,name)			\
- extern const struct gtype##_id __mod_##gtype##_table		\
-   __attribute__ ((unused, alias(__stringify(name))))
-@@ -94,9 +94,10 @@ extern const struct gtype##_id __mod_##g
+@@ -85,9 +85,10 @@ void trim_init_extable(struct module *m)
  
  /* Generic info of form tag = "info" */
  #define MODULE_INFO(tag, info) __MODULE_INFO(tag, tag, info)
@@ -26,7 +17,7 @@ Signed-off-by: Felix Fietkau <nbd@openwr
  
  /* Soft module dependencies. See man modprobe.d for details.
   * Example: MODULE_SOFTDEP("pre: module-foo module-bar post: module-baz")
-@@ -137,10 +138,10 @@ extern const struct gtype##_id __mod_##g
+@@ -128,12 +129,12 @@ void trim_init_extable(struct module *m)
   * Author(s), use "Name <email>" or just "Name", for multiple
   * authors use multiple MODULE_AUTHOR() statements/lines.
   */
@@ -37,9 +28,12 @@ Signed-off-by: Felix Fietkau <nbd@openwr
 -#define MODULE_DESCRIPTION(_description) MODULE_INFO(description, _description)
 +#define MODULE_DESCRIPTION(_description) MODULE_INFO_STRIP(description, _description)
  
- #define MODULE_DEVICE_TABLE(type,name)		\
-   MODULE_GENERIC_TABLE(type##_device,name)
-@@ -161,7 +162,9 @@ extern const struct gtype##_id __mod_##g
+-#ifdef MODULE
++#if defined(MODULE) && !defined(CONFIG_MODULE_STRIPPED)
+ /* Creates an alias so file2alias.c can find device table. */
+ #define MODULE_DEVICE_TABLE(type, name)					\
+   extern const struct type##_device_id __mod_##type##__##name##_device_table \
+@@ -158,7 +159,9 @@ void trim_init_extable(struct module *m)
  */
  
  #if defined(MODULE) || !defined(CONFIG_SYSFS)
@@ -50,7 +44,7 @@ Signed-off-by: Felix Fietkau <nbd@openwr
  #else
  #define MODULE_VERSION(_version)					\
  	static struct module_version_attribute ___modver_attr = {	\
-@@ -183,7 +186,7 @@ extern const struct gtype##_id __mod_##g
+@@ -180,7 +183,7 @@ void trim_init_extable(struct module *m)
  /* Optional firmware file (or files) needed by the module
   * format is simply firmware file name.  Multiple firmware
   * files require multiple MODULE_FIRMWARE() specifiers */
@@ -99,7 +93,7 @@ Signed-off-by: Felix Fietkau <nbd@openwr
  
 --- a/init/Kconfig
 +++ b/init/Kconfig
-@@ -1829,6 +1829,13 @@ config MODULE_SIG_HASH
+@@ -1837,6 +1837,13 @@ config MODULE_SIG_HASH
  	default "sha384" if MODULE_SIG_SHA384
  	default "sha512" if MODULE_SIG_SHA512
  
@@ -115,7 +109,7 @@ Signed-off-by: Felix Fietkau <nbd@openwr
  config INIT_ALL_POSSIBLE
 --- a/kernel/module.c
 +++ b/kernel/module.c
-@@ -2705,6 +2705,7 @@ static struct module *setup_load_info(st
+@@ -2731,6 +2731,7 @@ static struct module *setup_load_info(st
  
  static int check_modinfo(struct module *mod, struct load_info *info, int flags)
  {
@@ -123,7 +117,7 @@ Signed-off-by: Felix Fietkau <nbd@openwr
  	const char *modmagic = get_modinfo(info, "vermagic");
  	int err;
  
-@@ -2731,6 +2732,7 @@ static int check_modinfo(struct module *
+@@ -2757,6 +2758,7 @@ static int check_modinfo(struct module *
  		       " the quality is unknown, you have been warned.\n",
  		       mod->name);
  	}
@@ -133,7 +127,7 @@ Signed-off-by: Felix Fietkau <nbd@openwr
  	set_license(mod, get_modinfo(info, "license"));
 --- a/scripts/mod/modpost.c
 +++ b/scripts/mod/modpost.c
-@@ -1707,7 +1707,9 @@ static void read_symbols(char *modname)
+@@ -1711,7 +1711,9 @@ static void read_symbols(char *modname)
  		symname = info.strtab + sym->st_name;
  
  		handle_modversions(mod, &info, sym, symname);
@@ -143,7 +137,7 @@ Signed-off-by: Felix Fietkau <nbd@openwr
  	}
  	if (!is_vmlinux(modname) ||
  	     (is_vmlinux(modname) && vmlinux_section_warnings))
-@@ -1851,7 +1853,9 @@ static void add_header(struct buffer *b,
+@@ -1855,7 +1857,9 @@ static void add_header(struct buffer *b,
  	buf_printf(b, "#include <linux/vermagic.h>\n");
  	buf_printf(b, "#include <linux/compiler.h>\n");
  	buf_printf(b, "\n");
@@ -153,7 +147,7 @@ Signed-off-by: Felix Fietkau <nbd@openwr
  	buf_printf(b, "\n");
  	buf_printf(b, "struct module __this_module\n");
  	buf_printf(b, "__attribute__((section(\".gnu.linkonce.this_module\"))) = {\n");
-@@ -1868,16 +1872,20 @@ static void add_header(struct buffer *b,
+@@ -1872,16 +1876,20 @@ static void add_header(struct buffer *b,
  
  static void add_intree_flag(struct buffer *b, int is_intree)
  {
@@ -174,7 +168,7 @@ Signed-off-by: Felix Fietkau <nbd@openwr
  }
  
  /**
-@@ -1970,11 +1978,13 @@ static void add_depends(struct buffer *b
+@@ -1974,11 +1982,13 @@ static void add_depends(struct buffer *b
  
  static void add_srcversion(struct buffer *b, struct module *mod)
  {
@@ -188,7 +182,7 @@ Signed-off-by: Felix Fietkau <nbd@openwr
  }
  
  static void write_if_changed(struct buffer *b, const char *fname)
-@@ -2200,7 +2210,9 @@ int main(int argc, char **argv)
+@@ -2204,7 +2214,9 @@ int main(int argc, char **argv)
  		add_staging_flag(&buf, mod->name);
  		err |= add_versions(&buf, mod);
  		add_depends(&buf, mod, modules);
diff --git a/target/linux/generic/patches-3.12/259-regmap_dynamic.patch b/target/linux/generic/patches-3.12/259-regmap_dynamic.patch
--- a/target/linux/generic/patches-3.12/259-regmap_dynamic.patch
+++ b/target/linux/generic/patches-3.12/259-regmap_dynamic.patch
@@ -64,7 +64,7 @@
  #include <linux/mutex.h>
  #include <linux/err.h>
  #include <linux/rbtree.h>
-@@ -1959,3 +1960,5 @@ static int __init regmap_initcall(void)
+@@ -1966,3 +1967,5 @@ static int __init regmap_initcall(void)
  	return 0;
  }
  postcore_initcall(regmap_initcall);
diff --git a/target/linux/generic/patches-3.12/320-ppc4xx_optimization.patch b/target/linux/generic/patches-3.12/320-ppc4xx_optimization.patch
--- a/target/linux/generic/patches-3.12/320-ppc4xx_optimization.patch
+++ b/target/linux/generic/patches-3.12/320-ppc4xx_optimization.patch
@@ -3,7 +3,7 @@ they still want to support gcc 3.3 -- we
 
 --- a/arch/powerpc/Makefile
 +++ b/arch/powerpc/Makefile
-@@ -154,7 +154,8 @@ ifeq ($(CONFIG_FUNCTION_TRACER),y)
+@@ -156,7 +156,8 @@ ifeq ($(CONFIG_FUNCTION_TRACER),y)
  KBUILD_CFLAGS		+= -mno-sched-epilog
  endif
  
diff --git a/target/linux/generic/patches-3.12/321-powerpc_crtsavres_prereq.patch b/target/linux/generic/patches-3.12/321-powerpc_crtsavres_prereq.patch
--- a/target/linux/generic/patches-3.12/321-powerpc_crtsavres_prereq.patch
+++ b/target/linux/generic/patches-3.12/321-powerpc_crtsavres_prereq.patch
@@ -1,6 +1,6 @@
 --- a/arch/powerpc/Makefile
 +++ b/arch/powerpc/Makefile
-@@ -121,7 +121,6 @@ CPP		= $(CC) -E $(KBUILD_CFLAGS)
+@@ -123,7 +123,6 @@ CPP		= $(CC) -E $(KBUILD_CFLAGS)
  
  CHECKFLAGS	+= -m$(CONFIG_WORD_SIZE) -D__powerpc__ -D__powerpc$(CONFIG_WORD_SIZE)__
  
diff --git a/target/linux/generic/patches-3.12/400-mtd-add-rootfs-split-support.patch b/target/linux/generic/patches-3.12/400-mtd-add-rootfs-split-support.patch
--- a/target/linux/generic/patches-3.12/400-mtd-add-rootfs-split-support.patch
+++ b/target/linux/generic/patches-3.12/400-mtd-add-rootfs-split-support.patch
@@ -265,7 +265,7 @@
  /*
   * This function, given a master MTD object and a partition table, creates
   * and registers slave MTD objects which are bound to the master according to
-@@ -643,6 +794,7 @@ int add_mtd_partitions(struct mtd_info *
+@@ -645,6 +796,7 @@ int add_mtd_partitions(struct mtd_info *
  		mutex_unlock(&mtd_partitions_mutex);
  
  		add_mtd_device(&slave->mtd);
diff --git a/target/linux/generic/patches-3.12/401-mtd-add-support-for-different-partition-parser-types.patch b/target/linux/generic/patches-3.12/401-mtd-add-support-for-different-partition-parser-types.patch
--- a/target/linux/generic/patches-3.12/401-mtd-add-support-for-different-partition-parser-types.patch
+++ b/target/linux/generic/patches-3.12/401-mtd-add-support-for-different-partition-parser-types.patch
@@ -11,7 +11,7 @@ Signed-off-by: Gabor Juhos <juhosg@openw
 
 --- a/drivers/mtd/mtdpart.c
 +++ b/drivers/mtd/mtdpart.c
-@@ -824,6 +824,30 @@ static struct mtd_part_parser *get_parti
+@@ -826,6 +826,30 @@ static struct mtd_part_parser *get_parti
  
  #define put_partition_parser(p) do { module_put((p)->owner); } while (0)
  
@@ -42,7 +42,7 @@ Signed-off-by: Gabor Juhos <juhosg@openw
  int register_mtd_parser(struct mtd_part_parser *p)
  {
  	spin_lock(&part_parser_lock);
-@@ -900,6 +924,38 @@ int parse_mtd_partitions(struct mtd_info
+@@ -902,6 +926,38 @@ int parse_mtd_partitions(struct mtd_info
  	return ret;
  }
  
diff --git a/target/linux/generic/patches-3.12/405-mtd-add-more-helper-functions.patch b/target/linux/generic/patches-3.12/405-mtd-add-more-helper-functions.patch
--- a/target/linux/generic/patches-3.12/405-mtd-add-more-helper-functions.patch
+++ b/target/linux/generic/patches-3.12/405-mtd-add-more-helper-functions.patch
@@ -18,7 +18,7 @@
  	}
  	if (slave->offset == MTDPART_OFS_RETAIN) {
  		slave->offset = cur_offset;
-@@ -988,6 +986,24 @@ int mtd_is_partition(const struct mtd_in
+@@ -990,6 +988,24 @@ int mtd_is_partition(const struct mtd_in
  }
  EXPORT_SYMBOL_GPL(mtd_is_partition);
  
diff --git a/target/linux/generic/patches-3.12/532-jffs2_eofdetect.patch b/target/linux/generic/patches-3.12/532-jffs2_eofdetect.patch
--- a/target/linux/generic/patches-3.12/532-jffs2_eofdetect.patch
+++ b/target/linux/generic/patches-3.12/532-jffs2_eofdetect.patch
@@ -1,6 +1,6 @@
 --- a/fs/jffs2/build.c
 +++ b/fs/jffs2/build.c
-@@ -114,6 +114,16 @@ static int jffs2_build_filesystem(struct
+@@ -116,6 +116,16 @@ static int jffs2_build_filesystem(struct
  	dbg_fsbuild("scanned flash completely\n");
  	jffs2_dbg_dump_block_lists_nolock(c);
  
@@ -36,7 +36,7 @@
  
  		if (ret < 0)
  			goto out;
-@@ -556,6 +562,17 @@ static int jffs2_scan_eraseblock (struct
+@@ -561,6 +567,17 @@ full_scan:
  			return err;
  	}
  
diff --git a/target/linux/generic/patches-3.12/540-crypto-xz-decompression-support.patch b/target/linux/generic/patches-3.12/540-crypto-xz-decompression-support.patch
--- a/target/linux/generic/patches-3.12/540-crypto-xz-decompression-support.patch
+++ b/target/linux/generic/patches-3.12/540-crypto-xz-decompression-support.patch
@@ -16,7 +16,7 @@
  config CRYPTO_ANSI_CPRNG
 --- a/crypto/Makefile
 +++ b/crypto/Makefile
-@@ -88,6 +88,7 @@ obj-$(CONFIG_CRYPTO_AUTHENC) += authenc.
+@@ -93,6 +93,7 @@ obj-$(CONFIG_CRYPTO_AUTHENC) += authenc.
  obj-$(CONFIG_CRYPTO_LZO) += lzo.o
  obj-$(CONFIG_CRYPTO_LZ4) += lz4.o
  obj-$(CONFIG_CRYPTO_LZ4HC) += lz4hc.o
diff --git a/target/linux/generic/patches-3.12/550-ubifs-symlink-xattr-support.patch b/target/linux/generic/patches-3.12/550-ubifs-symlink-xattr-support.patch
--- a/target/linux/generic/patches-3.12/550-ubifs-symlink-xattr-support.patch
+++ b/target/linux/generic/patches-3.12/550-ubifs-symlink-xattr-support.patch
@@ -1,6 +1,6 @@
 --- a/fs/ubifs/file.c
 +++ b/fs/ubifs/file.c
-@@ -1577,6 +1577,12 @@ const struct inode_operations ubifs_syml
+@@ -1576,6 +1576,12 @@ const struct inode_operations ubifs_syml
  	.follow_link = ubifs_follow_link,
  	.setattr     = ubifs_setattr,
  	.getattr     = ubifs_getattr,
diff --git a/target/linux/generic/patches-3.12/610-netfilter_match_bypass_default_checks.patch b/target/linux/generic/patches-3.12/610-netfilter_match_bypass_default_checks.patch
--- a/target/linux/generic/patches-3.12/610-netfilter_match_bypass_default_checks.patch
+++ b/target/linux/generic/patches-3.12/610-netfilter_match_bypass_default_checks.patch
@@ -50,25 +50,24 @@
  static bool
  ip_checkentry(const struct ipt_ip *ip)
  {
-@@ -560,7 +586,7 @@ static void cleanup_match(struct xt_entr
+@@ -559,13 +585,15 @@ static void cleanup_match(struct xt_entr
  }
  
  static int
--check_entry(const struct ipt_entry *e, const char *name)
-+check_entry(struct ipt_entry *e, const char *name)
+-check_entry(const struct ipt_entry *e)
++check_entry(struct ipt_entry *e)
  {
  	const struct xt_entry_target *t;
  
-@@ -569,6 +595,8 @@ check_entry(const struct ipt_entry *e, c
+ 	if (!ip_checkentry(&e->ip))
  		return -EINVAL;
- 	}
  
 +	ip_checkdefault(&e->ip);
 +
  	if (e->target_offset + sizeof(struct xt_entry_target) >
  	    e->next_offset)
  		return -EINVAL;
-@@ -930,6 +958,7 @@ copy_entries_to_user(unsigned int total_
+@@ -929,6 +957,7 @@ copy_entries_to_user(unsigned int total_
  	const struct xt_table_info *private = table->private;
  	int ret = 0;
  	const void *loc_cpu_entry;
@@ -76,7 +75,7 @@
  
  	counters = alloc_counters(table);
  	if (IS_ERR(counters))
-@@ -960,6 +989,14 @@ copy_entries_to_user(unsigned int total_
+@@ -959,6 +988,14 @@ copy_entries_to_user(unsigned int total_
  			ret = -EFAULT;
  			goto free_counters;
  		}
diff --git a/target/linux/generic/patches-3.12/630-packet_socket_type.patch b/target/linux/generic/patches-3.12/630-packet_socket_type.patch
--- a/target/linux/generic/patches-3.12/630-packet_socket_type.patch
+++ b/target/linux/generic/patches-3.12/630-packet_socket_type.patch
@@ -26,7 +26,7 @@ Signed-off-by: Felix Fietkau <nbd@openwr
  #define PACKET_FANOUT_LB		1
 --- a/net/packet/af_packet.c
 +++ b/net/packet/af_packet.c
-@@ -1414,6 +1414,7 @@ static int packet_rcv_spkt(struct sk_buf
+@@ -1402,6 +1402,7 @@ static int packet_rcv_spkt(struct sk_buf
  {
  	struct sock *sk;
  	struct sockaddr_pkt *spkt;
@@ -34,7 +34,7 @@ Signed-off-by: Felix Fietkau <nbd@openwr
  
  	/*
  	 *	When we registered the protocol we saved the socket in the data
-@@ -1421,6 +1422,7 @@ static int packet_rcv_spkt(struct sk_buf
+@@ -1409,6 +1410,7 @@ static int packet_rcv_spkt(struct sk_buf
  	 */
  
  	sk = pt->af_packet_priv;
@@ -42,7 +42,7 @@ Signed-off-by: Felix Fietkau <nbd@openwr
  
  	/*
  	 *	Yank back the headers [hope the device set this
-@@ -1433,7 +1435,7 @@ static int packet_rcv_spkt(struct sk_buf
+@@ -1421,7 +1423,7 @@ static int packet_rcv_spkt(struct sk_buf
  	 *	so that this procedure is noop.
  	 */
  
@@ -51,7 +51,7 @@ Signed-off-by: Felix Fietkau <nbd@openwr
  		goto out;
  
  	if (!net_eq(dev_net(dev), sock_net(sk)))
-@@ -1640,12 +1642,12 @@ static int packet_rcv(struct sk_buff *sk
+@@ -1628,12 +1630,12 @@ static int packet_rcv(struct sk_buff *sk
  	int skb_len = skb->len;
  	unsigned int snaplen, res;
  
@@ -67,7 +67,7 @@ Signed-off-by: Felix Fietkau <nbd@openwr
  	if (!net_eq(dev_net(dev), sock_net(sk)))
  		goto drop;
  
-@@ -1758,12 +1760,12 @@ static int tpacket_rcv(struct sk_buff *s
+@@ -1746,12 +1748,12 @@ static int tpacket_rcv(struct sk_buff *s
  	struct timespec ts;
  	__u32 ts_status;
  
@@ -83,7 +83,7 @@ Signed-off-by: Felix Fietkau <nbd@openwr
  	if (!net_eq(dev_net(dev), sock_net(sk)))
  		goto drop;
  
-@@ -2652,6 +2654,7 @@ static int packet_create(struct net *net
+@@ -2664,6 +2666,7 @@ static int packet_create(struct net *net
  	spin_lock_init(&po->bind_lock);
  	mutex_init(&po->pg_vec_lock);
  	po->prot_hook.func = packet_rcv;
@@ -91,7 +91,7 @@ Signed-off-by: Felix Fietkau <nbd@openwr
  
  	if (sock->type == SOCK_PACKET)
  		po->prot_hook.func = packet_rcv_spkt;
-@@ -3218,6 +3221,16 @@ packet_setsockopt(struct socket *sock, i
+@@ -3230,6 +3233,16 @@ packet_setsockopt(struct socket *sock, i
  		po->tp_tx_has_off = !!val;
  		return 0;
  	}
@@ -108,7 +108,7 @@ Signed-off-by: Felix Fietkau <nbd@openwr
  	default:
  		return -ENOPROTOOPT;
  	}
-@@ -3269,6 +3282,13 @@ static int packet_getsockopt(struct sock
+@@ -3281,6 +3294,13 @@ static int packet_getsockopt(struct sock
  	case PACKET_VNET_HDR:
  		val = po->has_vnet_hdr;
  		break;
@@ -124,7 +124,7 @@ Signed-off-by: Felix Fietkau <nbd@openwr
  		break;
 --- a/net/packet/internal.h
 +++ b/net/packet/internal.h
-@@ -115,6 +115,7 @@ struct packet_sock {
+@@ -116,6 +116,7 @@ struct packet_sock {
  	unsigned int		tp_tstamp;
  	struct net_device __rcu	*cached_dev;
  	struct packet_type	prot_hook ____cacheline_aligned_in_smp;
diff --git a/target/linux/generic/patches-3.12/643-bridge_remove_ipv6_dependency.patch b/target/linux/generic/patches-3.12/643-bridge_remove_ipv6_dependency.patch
--- a/target/linux/generic/patches-3.12/643-bridge_remove_ipv6_dependency.patch
+++ b/target/linux/generic/patches-3.12/643-bridge_remove_ipv6_dependency.patch
@@ -32,7 +32,7 @@
 +obj-$(subst m,y,$(CONFIG_IPV6)) += inet6_stubs.o
 --- a/net/ipv6/addrconf.c
 +++ b/net/ipv6/addrconf.c
-@@ -1285,7 +1285,7 @@ out:
+@@ -1290,7 +1290,7 @@ out:
  	return ret;
  }
  
@@ -41,7 +41,7 @@
  		       const struct in6_addr *daddr, unsigned int prefs,
  		       struct in6_addr *saddr)
  {
-@@ -1410,7 +1410,6 @@ try_nextdev:
+@@ -1415,7 +1415,6 @@ try_nextdev:
  	in6_ifa_put(hiscore->ifa);
  	return 0;
  }
@@ -49,7 +49,7 @@
  
  int __ipv6_get_lladdr(struct inet6_dev *idev, struct in6_addr *addr,
  		      unsigned char banned_flags)
-@@ -5188,6 +5187,9 @@ int __init addrconf_init(void)
+@@ -5226,6 +5225,9 @@ int __init addrconf_init(void)
  
  	ipv6_addr_label_rtnl_register();
  
@@ -59,7 +59,7 @@
  	return 0;
  errout:
  	rtnl_af_unregister(&inet6_ops);
-@@ -5206,6 +5208,9 @@ void addrconf_cleanup(void)
+@@ -5244,6 +5246,9 @@ void addrconf_cleanup(void)
  	struct net_device *dev;
  	int i;
  
diff --git a/target/linux/generic/patches-3.12/644-bridge_optimize_netfilter_hooks.patch b/target/linux/generic/patches-3.12/644-bridge_optimize_netfilter_hooks.patch
--- a/target/linux/generic/patches-3.12/644-bridge_optimize_netfilter_hooks.patch
+++ b/target/linux/generic/patches-3.12/644-bridge_optimize_netfilter_hooks.patch
@@ -96,7 +96,7 @@
  	if (vlan_tx_tag_present(skb))
 --- a/net/bridge/br_private.h
 +++ b/net/bridge/br_private.h
-@@ -735,15 +735,29 @@ static inline u16 br_get_pvid(const stru
+@@ -745,15 +745,29 @@ static inline u16 br_get_pvid(const stru
  
  /* br_netfilter.c */
  #ifdef CONFIG_BRIDGE_NETFILTER
@@ -139,7 +139,7 @@
  
 --- a/net/bridge/netfilter/ebtables.c
 +++ b/net/bridge/netfilter/ebtables.c
-@@ -2407,11 +2407,13 @@ static int __init ebtables_init(void)
+@@ -2406,11 +2406,13 @@ static int __init ebtables_init(void)
  	}
  
  	printk(KERN_INFO "Ebtables v2.0 registered\n");
diff --git a/target/linux/generic/patches-3.12/650-pppoe_header_pad.patch b/target/linux/generic/patches-3.12/650-pppoe_header_pad.patch
--- a/target/linux/generic/patches-3.12/650-pppoe_header_pad.patch
+++ b/target/linux/generic/patches-3.12/650-pppoe_header_pad.patch
@@ -1,6 +1,6 @@
 --- a/drivers/net/ppp/pppoe.c
 +++ b/drivers/net/ppp/pppoe.c
-@@ -850,7 +850,7 @@ static int pppoe_sendmsg(struct kiocb *i
+@@ -870,7 +870,7 @@ static int pppoe_sendmsg(struct kiocb *i
  		goto end;
  
  
@@ -9,7 +9,7 @@
  			   0, GFP_KERNEL);
  	if (!skb) {
  		error = -ENOMEM;
-@@ -858,7 +858,7 @@ static int pppoe_sendmsg(struct kiocb *i
+@@ -878,7 +878,7 @@ static int pppoe_sendmsg(struct kiocb *i
  	}
  
  	/* Reserve space for headers. */
diff --git a/target/linux/generic/patches-3.12/653-disable_netlink_trim.patch b/target/linux/generic/patches-3.12/653-disable_netlink_trim.patch
--- a/target/linux/generic/patches-3.12/653-disable_netlink_trim.patch
+++ b/target/linux/generic/patches-3.12/653-disable_netlink_trim.patch
@@ -1,6 +1,6 @@
 --- a/net/netlink/af_netlink.c
 +++ b/net/netlink/af_netlink.c
-@@ -1665,27 +1665,7 @@ void netlink_detachskb(struct sock *sk,
+@@ -1741,27 +1741,7 @@ void netlink_detachskb(struct sock *sk,
  
  static struct sk_buff *netlink_trim(struct sk_buff *skb, gfp_t allocation)
  {
diff --git a/target/linux/generic/patches-3.12/655-increase_skb_pad.patch b/target/linux/generic/patches-3.12/655-increase_skb_pad.patch
--- a/target/linux/generic/patches-3.12/655-increase_skb_pad.patch
+++ b/target/linux/generic/patches-3.12/655-increase_skb_pad.patch
@@ -1,6 +1,6 @@
 --- a/include/linux/skbuff.h
 +++ b/include/linux/skbuff.h
-@@ -1746,7 +1746,7 @@ static inline int pskb_network_may_pull(
+@@ -1772,7 +1772,7 @@ static inline int pskb_network_may_pull(
   * NET_IP_ALIGN(2) + ethernet_header(14) + IP_header(20/40) + ports(8)
   */
  #ifndef NET_SKB_PAD
diff --git a/target/linux/generic/patches-3.12/656-skb_reduce_truesize-helper.patch b/target/linux/generic/patches-3.12/656-skb_reduce_truesize-helper.patch
--- a/target/linux/generic/patches-3.12/656-skb_reduce_truesize-helper.patch
+++ b/target/linux/generic/patches-3.12/656-skb_reduce_truesize-helper.patch
@@ -14,7 +14,7 @@ when needed.
 
 --- a/include/linux/skbuff.h
 +++ b/include/linux/skbuff.h
-@@ -1791,6 +1791,24 @@ static inline void pskb_trim_unique(stru
+@@ -1817,6 +1817,24 @@ static inline void pskb_trim_unique(stru
  	BUG_ON(err);
  }
  
diff --git a/target/linux/generic/patches-3.12/664-codel_fix_3_12.patch b/target/linux/generic/patches-3.12/664-codel_fix_3_12.patch
--- a/target/linux/generic/patches-3.12/664-codel_fix_3_12.patch
+++ b/target/linux/generic/patches-3.12/664-codel_fix_3_12.patch
@@ -1,6 +1,6 @@
 --- a/net/sched/sch_api.c
 +++ b/net/sched/sch_api.c
-@@ -1906,7 +1906,7 @@ static int __init pktsched_init(void)
+@@ -1908,7 +1908,7 @@ static int __init pktsched_init(void)
  		return err;
  	}
  
diff --git a/target/linux/generic/patches-3.12/670-ipv6-allow-rejecting-with-source-address-failed-policy.patch b/target/linux/generic/patches-3.12/670-ipv6-allow-rejecting-with-source-address-failed-policy.patch
--- a/target/linux/generic/patches-3.12/670-ipv6-allow-rejecting-with-source-address-failed-policy.patch
+++ b/target/linux/generic/patches-3.12/670-ipv6-allow-rejecting-with-source-address-failed-policy.patch
@@ -143,7 +143,7 @@ Signed-off-by: Jonas Gorski <jogo@openwr
  static const struct rt6_info ip6_blk_hole_entry_template = {
  	.dst = {
  		.__refcnt	= ATOMIC_INIT(1),
-@@ -1581,6 +1598,11 @@ int ip6_route_add(struct fib6_config *cf
+@@ -1579,6 +1596,11 @@ int ip6_route_add(struct fib6_config *cf
  			rt->dst.output = ip6_pkt_prohibit_out;
  			rt->dst.input = ip6_pkt_prohibit;
  			break;
@@ -155,7 +155,7 @@ Signed-off-by: Jonas Gorski <jogo@openwr
  		case RTN_THROW:
  		default:
  			rt->dst.error = (cfg->fc_type == RTN_THROW) ? -EAGAIN
-@@ -2160,6 +2182,17 @@ static int ip6_pkt_prohibit_out(struct s
+@@ -2158,6 +2180,17 @@ static int ip6_pkt_prohibit_out(struct s
  	return ip6_pkt_drop(skb, ICMPV6_ADM_PROHIBITED, IPSTATS_MIB_OUTNOROUTES);
  }
  
@@ -173,7 +173,7 @@ Signed-off-by: Jonas Gorski <jogo@openwr
  /*
   *	Allocate a dst for local (unicast / anycast) address.
   */
-@@ -2362,7 +2395,8 @@ static int rtm_to_fib6_config(struct sk_
+@@ -2360,7 +2393,8 @@ static int rtm_to_fib6_config(struct sk_
  	if (rtm->rtm_type == RTN_UNREACHABLE ||
  	    rtm->rtm_type == RTN_BLACKHOLE ||
  	    rtm->rtm_type == RTN_PROHIBIT ||
@@ -183,7 +183,7 @@ Signed-off-by: Jonas Gorski <jogo@openwr
  		cfg->fc_flags |= RTF_REJECT;
  
  	if (rtm->rtm_type == RTN_LOCAL)
-@@ -2564,6 +2598,9 @@ static int rt6_fill_node(struct net *net
+@@ -2562,6 +2596,9 @@ static int rt6_fill_node(struct net *net
  		case -EACCES:
  			rtm->rtm_type = RTN_PROHIBIT;
  			break;
@@ -193,7 +193,7 @@ Signed-off-by: Jonas Gorski <jogo@openwr
  		case -EAGAIN:
  			rtm->rtm_type = RTN_THROW;
  			break;
-@@ -2814,6 +2851,8 @@ static int ip6_route_dev_notify(struct n
+@@ -2812,6 +2849,8 @@ static int ip6_route_dev_notify(struct n
  #ifdef CONFIG_IPV6_MULTIPLE_TABLES
  		net->ipv6.ip6_prohibit_entry->dst.dev = dev;
  		net->ipv6.ip6_prohibit_entry->rt6i_idev = in6_dev_get(dev);
@@ -202,7 +202,7 @@ Signed-off-by: Jonas Gorski <jogo@openwr
  		net->ipv6.ip6_blk_hole_entry->dst.dev = dev;
  		net->ipv6.ip6_blk_hole_entry->rt6i_idev = in6_dev_get(dev);
  #endif
-@@ -3074,6 +3113,17 @@ static int __net_init ip6_route_net_init
+@@ -3072,6 +3111,17 @@ static int __net_init ip6_route_net_init
  	net->ipv6.ip6_blk_hole_entry->dst.ops = &net->ipv6.ip6_dst_ops;
  	dst_init_metrics(&net->ipv6.ip6_blk_hole_entry->dst,
  			 ip6_template_metrics, true);
@@ -220,7 +220,7 @@ Signed-off-by: Jonas Gorski <jogo@openwr
  #endif
  
  	net->ipv6.sysctl.flush_delay = 0;
-@@ -3092,6 +3142,8 @@ out:
+@@ -3090,6 +3140,8 @@ out:
  	return ret;
  
  #ifdef CONFIG_IPV6_MULTIPLE_TABLES
@@ -229,7 +229,7 @@ Signed-off-by: Jonas Gorski <jogo@openwr
  out_ip6_prohibit_entry:
  	kfree(net->ipv6.ip6_prohibit_entry);
  out_ip6_null_entry:
-@@ -3109,6 +3161,7 @@ static void __net_exit ip6_route_net_exi
+@@ -3107,6 +3159,7 @@ static void __net_exit ip6_route_net_exi
  #ifdef CONFIG_IPV6_MULTIPLE_TABLES
  	kfree(net->ipv6.ip6_prohibit_entry);
  	kfree(net->ipv6.ip6_blk_hole_entry);
@@ -237,7 +237,7 @@ Signed-off-by: Jonas Gorski <jogo@openwr
  #endif
  	dst_entries_destroy(&net->ipv6.ip6_dst_ops);
  }
-@@ -3205,6 +3258,9 @@ int __init ip6_route_init(void)
+@@ -3203,6 +3256,9 @@ int __init ip6_route_init(void)
  	init_net.ipv6.ip6_prohibit_entry->rt6i_idev = in6_dev_get(init_net.loopback_dev);
  	init_net.ipv6.ip6_blk_hole_entry->dst.dev = init_net.loopback_dev;
  	init_net.ipv6.ip6_blk_hole_entry->rt6i_idev = in6_dev_get(init_net.loopback_dev);
diff --git a/target/linux/generic/patches-3.12/701-phy_extension.patch b/target/linux/generic/patches-3.12/701-phy_extension.patch
--- a/target/linux/generic/patches-3.12/701-phy_extension.patch
+++ b/target/linux/generic/patches-3.12/701-phy_extension.patch
@@ -1,6 +1,6 @@
 --- a/drivers/net/phy/phy.c
 +++ b/drivers/net/phy/phy.c
-@@ -302,6 +302,50 @@ int phy_ethtool_gset(struct phy_device *
+@@ -321,6 +321,50 @@ int phy_ethtool_gset(struct phy_device *
  }
  EXPORT_SYMBOL(phy_ethtool_gset);
  
diff --git a/target/linux/generic/patches-3.12/721-phy_packets.patch b/target/linux/generic/patches-3.12/721-phy_packets.patch
--- a/target/linux/generic/patches-3.12/721-phy_packets.patch
+++ b/target/linux/generic/patches-3.12/721-phy_packets.patch
@@ -34,7 +34,7 @@
  #define IF_GET_IFACE	0x0001		/* for querying only */
 --- a/include/linux/skbuff.h
 +++ b/include/linux/skbuff.h
-@@ -1776,6 +1776,10 @@ static inline int pskb_trim(struct sk_bu
+@@ -1802,6 +1802,10 @@ static inline int pskb_trim(struct sk_bu
  	return (len < skb->len) ? __pskb_trim(skb, len) : 0;
  }
  
@@ -45,7 +45,7 @@
  /**
   *	pskb_trim_unique - remove end from a paged unique (not cloned) buffer
   *	@skb: buffer to alter
-@@ -1903,16 +1907,6 @@ static inline struct sk_buff *dev_alloc_
+@@ -1929,16 +1933,6 @@ static inline struct sk_buff *dev_alloc_
  }
  
  
@@ -79,7 +79,7 @@
  	help
 --- a/net/core/dev.c
 +++ b/net/core/dev.c
-@@ -2600,9 +2600,19 @@ int dev_hard_start_xmit(struct sk_buff *
+@@ -2614,9 +2614,19 @@ int dev_hard_start_xmit(struct sk_buff *
  		if (!list_empty(&ptype_all))
  			dev_queue_xmit_nit(skb, dev);
  
@@ -102,7 +102,7 @@
  		if (rc == NETDEV_TX_OK)
  			txq_trans_update(txq);
  		return rc;
-@@ -2618,9 +2628,19 @@ gso:
+@@ -2632,9 +2642,19 @@ gso:
  		if (!list_empty(&ptype_all))
  			dev_queue_xmit_nit(nskb, dev);
  
@@ -127,15 +127,15 @@
  				goto out_kfree_gso_skb;
 --- a/net/core/skbuff.c
 +++ b/net/core/skbuff.c
-@@ -62,6 +62,7 @@
- #include <linux/scatterlist.h>
+@@ -63,6 +63,7 @@
  #include <linux/errqueue.h>
  #include <linux/prefetch.h>
+ #include <linux/if_vlan.h>
 +#include <linux/if.h>
  
  #include <net/protocol.h>
  #include <net/dst.h>
-@@ -438,6 +439,22 @@ struct sk_buff *__netdev_alloc_skb(struc
+@@ -461,6 +462,22 @@ struct sk_buff *__netdev_alloc_skb(struc
  }
  EXPORT_SYMBOL(__netdev_alloc_skb);
  
diff --git a/target/linux/generic/patches-3.12/810-pci_disable_common_quirks.patch b/target/linux/generic/patches-3.12/810-pci_disable_common_quirks.patch
--- a/target/linux/generic/patches-3.12/810-pci_disable_common_quirks.patch
+++ b/target/linux/generic/patches-3.12/810-pci_disable_common_quirks.patch
@@ -15,7 +15,7 @@
  	default y
 --- a/drivers/pci/quirks.c
 +++ b/drivers/pci/quirks.c
-@@ -44,6 +44,7 @@ static void quirk_mmio_always_on(struct
+@@ -45,6 +45,7 @@ static void quirk_mmio_always_on(struct
  DECLARE_PCI_FIXUP_CLASS_EARLY(PCI_ANY_ID, PCI_ANY_ID,
  				PCI_CLASS_BRIDGE_HOST, 8, quirk_mmio_always_on);
  
@@ -23,7 +23,7 @@
  /* The Mellanox Tavor device gives false positive parity errors
   * Mark this device with a broken_parity_status, to allow
   * PCI scanning code to "skip" this now blacklisted device.
-@@ -2864,6 +2865,7 @@ DECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_I
+@@ -2896,6 +2897,7 @@ DECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_I
  DECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_INTEL, 0x65f9, quirk_intel_mc_errata);
  DECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_INTEL, 0x65fa, quirk_intel_mc_errata);
  
@@ -31,7 +31,7 @@
  
  /*
   * Ivytown NTB BAR sizes are misreported by the hardware due to an erratum.  To
-@@ -2920,6 +2922,8 @@ static void fixup_debug_report(struct pc
+@@ -2952,6 +2954,8 @@ static void fixup_debug_report(struct pc
  	}
  }
  
@@ -40,9 +40,9 @@
  /*
   * Some BIOS implementations leave the Intel GPU interrupts enabled,
   * even though no one is handling them (f.e. i915 driver is never loaded).
-@@ -2954,6 +2958,8 @@ static void disable_igfx_irq(struct pci_
- DECLARE_PCI_FIXUP_FINAL(PCI_VENDOR_ID_INTEL, 0x0102, disable_igfx_irq);
+@@ -2987,6 +2991,8 @@ DECLARE_PCI_FIXUP_FINAL(PCI_VENDOR_ID_IN
  DECLARE_PCI_FIXUP_FINAL(PCI_VENDOR_ID_INTEL, 0x010a, disable_igfx_irq);
+ DECLARE_PCI_FIXUP_FINAL(PCI_VENDOR_ID_INTEL, 0x0152, disable_igfx_irq);
  
 +#endif /* !CONFIG_PCI_DISABLE_COMMON_QUIRKS */
 +
diff --git a/target/linux/generic/patches-3.12/811-pci_disable_usb_common_quirks.patch b/target/linux/generic/patches-3.12/811-pci_disable_usb_common_quirks.patch
--- a/target/linux/generic/patches-3.12/811-pci_disable_usb_common_quirks.patch
+++ b/target/linux/generic/patches-3.12/811-pci_disable_usb_common_quirks.patch
@@ -10,7 +10,7 @@
  static struct amd_chipset_info {
  	struct pci_dev	*nb_dev;
  	struct pci_dev	*smbus_dev;
-@@ -443,6 +445,10 @@ void usb_amd_dev_put(void)
+@@ -455,6 +457,10 @@ void usb_amd_dev_put(void)
  }
  EXPORT_SYMBOL_GPL(usb_amd_dev_put);
  
@@ -21,7 +21,7 @@
  /*
   * Make sure the controller is completely inactive, unable to
   * generate interrupts or do DMA.
-@@ -522,8 +528,17 @@ reset_needed:
+@@ -534,8 +540,17 @@ reset_needed:
  	uhci_reset_hc(pdev, base);
  	return 1;
  }
@@ -39,7 +39,7 @@
  static inline int io_type_enabled(struct pci_dev *pdev, unsigned int mask)
  {
  	u16 cmd;
-@@ -1052,3 +1067,4 @@ static void quirk_usb_early_handoff(stru
+@@ -1096,3 +1111,4 @@ static void quirk_usb_early_handoff(stru
  }
  DECLARE_PCI_FIXUP_CLASS_FINAL(PCI_ANY_ID, PCI_ANY_ID,
  			PCI_CLASS_SERIAL_USB, 8, quirk_usb_early_handoff);
diff --git a/target/linux/generic/patches-3.12/820-usb_add_usb_find_device_by_name.patch b/target/linux/generic/patches-3.12/820-usb_add_usb_find_device_by_name.patch
--- a/target/linux/generic/patches-3.12/820-usb_add_usb_find_device_by_name.patch
+++ b/target/linux/generic/patches-3.12/820-usb_add_usb_find_device_by_name.patch
@@ -74,7 +74,7 @@
   * @dev: device the buffer will be used with
 --- a/include/linux/usb.h
 +++ b/include/linux/usb.h
-@@ -692,6 +692,7 @@ static inline bool usb_device_no_sg_cons
+@@ -718,6 +718,7 @@ static inline bool usb_device_no_sg_cons
  	return udev && udev->bus && udev->bus->no_sg_constraint;
  }
  
diff --git a/target/linux/generic/patches-3.12/902-debloat_proc.patch b/target/linux/generic/patches-3.12/902-debloat_proc.patch
--- a/target/linux/generic/patches-3.12/902-debloat_proc.patch
+++ b/target/linux/generic/patches-3.12/902-debloat_proc.patch
@@ -1,6 +1,6 @@
 --- a/fs/locks.c
 +++ b/fs/locks.c
-@@ -2394,6 +2394,8 @@ static const struct file_operations proc
+@@ -2414,6 +2414,8 @@ static const struct file_operations proc
  
  static int __init proc_locks_init(void)
  {
@@ -79,17 +79,17 @@
  }
 --- a/kernel/irq/proc.c
 +++ b/kernel/irq/proc.c
-@@ -311,6 +311,9 @@ void register_irq_proc(unsigned int irq,
- {
+@@ -330,6 +330,9 @@ void register_irq_proc(unsigned int irq,
+ 	static DEFINE_MUTEX(register_lock);
  	char name [MAX_NAMELEN];
  
 +	if (IS_ENABLED(CONFIG_PROC_STRIPPED) && !IS_ENABLED(CONFIG_SMP))
 +		return;
 +
- 	if (!root_irq_dir || (desc->irq_data.chip == &no_irq_chip) || desc->dir)
+ 	if (!root_irq_dir || (desc->irq_data.chip == &no_irq_chip))
  		return;
  
-@@ -347,6 +350,9 @@ void unregister_irq_proc(unsigned int ir
+@@ -379,6 +382,9 @@ void unregister_irq_proc(unsigned int ir
  {
  	char name [MAX_NAMELEN];
  
@@ -99,7 +99,7 @@
  	if (!root_irq_dir || !desc->dir)
  		return;
  #ifdef CONFIG_SMP
-@@ -382,6 +388,9 @@ void init_irq_proc(void)
+@@ -414,6 +420,9 @@ void init_irq_proc(void)
  	unsigned int irq;
  	struct irq_desc *desc;
  
@@ -122,7 +122,7 @@
  		return -ENOMEM;
 --- a/mm/vmalloc.c
 +++ b/mm/vmalloc.c
-@@ -2663,6 +2663,8 @@ static const struct file_operations proc
+@@ -2669,6 +2669,8 @@ static const struct file_operations proc
  
  static int __init proc_vmalloc_init(void)
  {
@@ -133,7 +133,7 @@
  }
 --- a/mm/vmstat.c
 +++ b/mm/vmstat.c
-@@ -1281,10 +1281,12 @@ static int __init setup_vmstat(void)
+@@ -1285,10 +1285,12 @@ static int __init setup_vmstat(void)
  		start_cpu_timer(cpu);
  #endif
  #ifdef CONFIG_PROC_FS
@@ -173,7 +173,7 @@
  		goto err;
 --- a/net/core/sock.c
 +++ b/net/core/sock.c
-@@ -2935,6 +2935,8 @@ static __net_initdata struct pernet_oper
+@@ -2987,6 +2987,8 @@ static __net_initdata struct pernet_oper
  
  static int __init proto_init(void)
  {
@@ -199,7 +199,7 @@
  			 &fib_triestat_fops))
  		goto out2;
  
-@@ -2600,17 +2602,21 @@ int __net_init fib_proc_init(struct net 
+@@ -2600,17 +2602,21 @@ int __net_init fib_proc_init(struct net
  	return 0;
  
  out3:
@@ -239,7 +239,7 @@
  
 --- a/net/ipv4/route.c
 +++ b/net/ipv4/route.c
-@@ -424,6 +424,9 @@ static struct pernet_operations ip_rt_pr
+@@ -426,6 +426,9 @@ static struct pernet_operations ip_rt_pr
  
  static int __init ip_rt_proc_init(void)
  {
diff --git a/target/linux/generic/patches-3.12/903-debloat_direct_io.patch b/target/linux/generic/patches-3.12/903-debloat_direct_io.patch
--- a/target/linux/generic/patches-3.12/903-debloat_direct_io.patch
+++ b/target/linux/generic/patches-3.12/903-debloat_direct_io.patch
@@ -26,7 +26,7 @@
  endif
 --- a/include/linux/fs.h
 +++ b/include/linux/fs.h
-@@ -2487,12 +2487,26 @@ enum {
+@@ -2480,12 +2480,26 @@ enum {
  	DIO_SKIP_HOLES	= 0x02,
  };
  
@@ -68,7 +68,7 @@
  
 --- a/fs/open.c
 +++ b/fs/open.c
-@@ -651,9 +651,12 @@ int open_check_o_direct(struct file *f)
+@@ -640,9 +640,12 @@ int open_check_o_direct(struct file *f)
  {
  	/* NB: we're sure to have correct a_ops only after f_op->open */
  	if (f->f_flags & O_DIRECT) {
diff --git a/target/linux/generic/patches-3.12/921-use_preinit_as_init.patch b/target/linux/generic/patches-3.12/921-use_preinit_as_init.patch
--- a/target/linux/generic/patches-3.12/921-use_preinit_as_init.patch
+++ b/target/linux/generic/patches-3.12/921-use_preinit_as_init.patch
@@ -1,6 +1,6 @@
 --- a/init/main.c
 +++ b/init/main.c
-@@ -843,7 +843,8 @@ static int __ref kernel_init(void *unuse
+@@ -847,7 +847,8 @@ static int __ref kernel_init(void *unuse
  		pr_err("Failed to execute %s.  Attempting defaults...\n",
  			execute_command);
  	}
diff --git a/target/linux/generic/patches-3.12/940-ocf_kbuild_integration.patch b/target/linux/generic/patches-3.12/940-ocf_kbuild_integration.patch
--- a/target/linux/generic/patches-3.12/940-ocf_kbuild_integration.patch
+++ b/target/linux/generic/patches-3.12/940-ocf_kbuild_integration.patch
@@ -9,7 +9,7 @@
 +
 --- a/crypto/Makefile
 +++ b/crypto/Makefile
-@@ -99,6 +99,8 @@ obj-$(CONFIG_CRYPTO_USER_API) += af_alg.
+@@ -104,6 +104,8 @@ obj-$(CONFIG_CRYPTO_USER_API) += af_alg.
  obj-$(CONFIG_CRYPTO_USER_API_HASH) += algif_hash.o
  obj-$(CONFIG_CRYPTO_USER_API_SKCIPHER) += algif_skcipher.o
  
diff --git a/target/linux/generic/patches-3.12/941-ocf_20120127.patch b/target/linux/generic/patches-3.12/941-ocf_20120127.patch
--- a/target/linux/generic/patches-3.12/941-ocf_20120127.patch
+++ b/target/linux/generic/patches-3.12/941-ocf_20120127.patch
@@ -156,7 +156,7 @@
  void generate_random_uuid(unsigned char uuid_out[16]);
 --- a/kernel/pid.c
 +++ b/kernel/pid.c
-@@ -425,6 +425,7 @@ void transfer_pid(struct task_struct *ol
+@@ -428,6 +428,7 @@ void transfer_pid(struct task_struct *ol
  	new->pids[type].pid = old->pids[type].pid;
  	hlist_replace_rcu(&old->pids[type].node, &new->pids[type].node);
  }
diff --git a/target/linux/generic/patches-3.12/950-vm_exports.patch b/target/linux/generic/patches-3.12/950-vm_exports.patch
--- a/target/linux/generic/patches-3.12/950-vm_exports.patch
+++ b/target/linux/generic/patches-3.12/950-vm_exports.patch
@@ -1,6 +1,6 @@
 --- a/mm/shmem.c
 +++ b/mm/shmem.c
-@@ -2918,6 +2918,15 @@ static struct dentry_operations anon_ops
+@@ -2949,6 +2949,15 @@ static struct dentry_operations anon_ops
  	.d_dname = simple_dname
  };
  
@@ -16,7 +16,7 @@
  /**
   * shmem_file_setup - get an unlinked file living in tmpfs
   * @name: name for dentry (to be seen in /proc/<pid>/maps
-@@ -2991,11 +3000,8 @@ int shmem_zero_setup(struct vm_area_stru
+@@ -3022,11 +3031,8 @@ int shmem_zero_setup(struct vm_area_stru
  	file = shmem_file_setup("dev/zero", size, vma->vm_flags);
  	if (IS_ERR(file))
  		return PTR_ERR(file);
@@ -41,7 +41,7 @@
  {
 --- a/kernel/exit.c
 +++ b/kernel/exit.c
-@@ -490,6 +490,8 @@ static void exit_mm(struct task_struct *
+@@ -491,6 +491,8 @@ static void exit_mm(struct task_struct *
  	mm_update_next_owner(mm);
  	mmput(mm);
  }
@@ -52,7 +52,7 @@
   * When we die, we re-parent all our children, and try to:
 --- a/kernel/sched/core.c
 +++ b/kernel/sched/core.c
-@@ -3135,6 +3135,7 @@ int can_nice(const struct task_struct *p
+@@ -3164,6 +3164,7 @@ int can_nice(const struct task_struct *p
  	return (nice_rlim <= task_rlimit(p, RLIMIT_NICE) ||
  		capable(CAP_SYS_NICE));
  }
@@ -72,7 +72,7 @@
   * zap_page_range_single - remove user pages in a given range
 --- a/mm/vmalloc.c
 +++ b/mm/vmalloc.c
-@@ -1254,6 +1254,7 @@ void unmap_kernel_range(unsigned long ad
+@@ -1260,6 +1260,7 @@ void unmap_kernel_range(unsigned long ad
  	vunmap_page_range(addr, end);
  	flush_tlb_kernel_range(addr, end);
  }
@@ -80,7 +80,7 @@
  
  int map_vm_area(struct vm_struct *area, pgprot_t prot, struct page ***pages)
  {
-@@ -1361,6 +1362,7 @@ struct vm_struct *get_vm_area(unsigned l
+@@ -1367,6 +1368,7 @@ struct vm_struct *get_vm_area(unsigned l
  				  NUMA_NO_NODE, GFP_KERNEL,
  				  __builtin_return_address(0));
  }
@@ -98,4 +98,4 @@
 +extern void shmem_set_file(struct vm_area_struct *vma, struct file *file);
  extern int shmem_zero_setup(struct vm_area_struct *);
  extern int shmem_lock(struct file *file, int lock, struct user_struct *user);
- extern void shmem_unlock_mapping(struct address_space *mapping);
+ extern bool shmem_mapping(struct address_space *mapping);
