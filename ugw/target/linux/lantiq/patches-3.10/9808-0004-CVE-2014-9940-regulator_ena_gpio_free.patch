#CVE-2014-9940
#The regulator_ena_gpio_free function in drivers/regulator/core.c in the Linux kernel before 3.19 allows local users to gain privileges or cause a denial of service (use-after-free) via a crafted application.



author	Seung-Woo Kim <sw0312.kim@samsung.com>	2014-12-04 19:17:17 +0900
committer	Mark Brown <broonie@kernel.org>	2014-12-04 22:45:36 +0000
commit	60a2362f769cf549dc466134efe71c8bf9fbaaba (patch)
tree	d3a28bd5639ad1b4ee53019b09c0821df24e65ac
parent	194dbaefa0da24bb60d9df1c99dda807f51fc33f (diff)
download	linux-60a2362f769cf549dc466134efe71c8bf9fbaaba.tar.gz
regulator: core: Fix regualtor_ena_gpio_free not to access pin after freeing
After freeing pin from regulator_ena_gpio_free, loop can access
the pin. So this patch fixes not to access pin after freeing.

Signed-off-by: Seung-Woo Kim <sw0312.kim@samsung.com>
Signed-off-by: Mark Brown <broonie@kernel.org>

diff --git a/drivers/regulator/core.c b/drivers/regulator/core.c
--- a/drivers/regulator/core.c
+++ b/drivers/regulator/core.c
@@ -1534,6 +1534,8 @@ static void regulator_ena_gpio_free(stru
 				gpio_free(pin->gpio);
 				list_del(&pin->list);
 				kfree(pin);
+				rdev->ena_pin = NULL;
+				return;
 			} else {
 				pin->request_count--;
 			}
